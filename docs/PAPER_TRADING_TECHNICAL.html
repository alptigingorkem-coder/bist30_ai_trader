<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Paper Trading Teknik DokÃ¼mantasyonu | BIST30 AI Trader</title>
    <style>
        :root {
            --primary: #1a365d;
            --secondary: #2b6cb0;
            --accent: #38a169;
            --warning: #dd6b20;
            --danger: #e53e3e;
            --bg: #f7fafc;
            --card-bg: #ffffff;
            --text: #2d3748;
            --text-muted: #718096;
            --border: #e2e8f0;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
        }

        .container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 60px 20px;
            text-align: center;
        }

        header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
        }

        header .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        header .version {
            display: inline-block;
            background: rgba(255, 255, 255, 0.2);
            padding: 5px 15px;
            border-radius: 20px;
            margin-top: 15px;
            font-size: 0.9rem;
        }

        .card {
            background: var(--card-bg);
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid var(--border);
        }

        .card h2 {
            color: var(--primary);
            font-size: 1.5rem;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--secondary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card h3 {
            color: var(--secondary);
            font-size: 1.2rem;
            margin: 25px 0 15px 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            font-size: 0.95rem;
        }

        th,
        td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        th {
            background: var(--primary);
            color: white;
            font-weight: 600;
        }

        tr:hover {
            background: #f8fafc;
        }

        code {
            background: #edf2f7;
            padding: 2px 8px;
            border-radius: 4px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.9em;
            color: var(--secondary);
        }

        pre {
            background: #1a202c;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 15px 0;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        pre code {
            background: none;
            color: inherit;
            padding: 0;
        }

        .highlight-green {
            color: #68d391;
        }

        .highlight-blue {
            color: #63b3ed;
        }

        .highlight-yellow {
            color: #faf089;
        }

        .highlight-purple {
            color: #b794f4;
        }

        .flow-diagram {
            background: linear-gradient(135deg, #f6f8fc 0%, #edf2f7 100%);
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 30px;
            text-align: center;
            font-family: 'Consolas', monospace;
            font-size: 0.85rem;
            white-space: pre;
            overflow-x: auto;
        }

        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .badge-success {
            background: #c6f6d5;
            color: #22543d;
        }

        .badge-warning {
            background: #feebc8;
            color: #744210;
        }

        .badge-danger {
            background: #fed7d7;
            color: #742a2a;
        }

        .badge-info {
            background: #bee3f8;
            color: #2a4365;
        }

        .alert {
            padding: 15px 20px;
            border-radius: 8px;
            margin: 15px 0;
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }

        .alert-warning {
            background: #fffaf0;
            border-left: 4px solid var(--warning);
        }

        .alert-info {
            background: #ebf8ff;
            border-left: 4px solid var(--secondary);
        }

        .formula-box {
            background: #faf5ff;
            border: 1px solid #e9d8fd;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            font-family: 'Consolas', monospace;
        }

        .formula-box .formula {
            font-size: 1.1rem;
            color: #553c9a;
            margin: 10px 0;
        }

        .toc {
            background: #f7fafc;
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 20px 30px;
            margin-bottom: 30px;
        }

        .toc h3 {
            margin-bottom: 15px;
            color: var(--primary);
        }

        .toc ul {
            list-style: none;
        }

        .toc li {
            padding: 5px 0;
        }

        .toc a {
            color: var(--secondary);
            text-decoration: none;
        }

        .toc a:hover {
            text-decoration: underline;
        }

        footer {
            text-align: center;
            padding: 40px;
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            header h1 {
                font-size: 1.8rem;
            }

            .card {
                padding: 20px;
            }

            table {
                font-size: 0.85rem;
            }
        }
    </style>
</head>

<body>

    <header>
        <h1>ğŸ“Š Paper Trading Teknik DokÃ¼mantasyonu</h1>
        <p class="subtitle">BIST30 AI Trader - Shadow Execution Engine</p>
        <span class="version">v1.0 | 2026-02-01</span>
    </header>

    <div class="container">

        <nav class="toc">
            <h3>ğŸ“‘ Ä°Ã§indekiler</h3>
            <ul>
                <li>1. <a href="#architecture">Mimari Genel BakÄ±ÅŸ</a></li>
                <li>2. <a href="#files">Dosya YapÄ±sÄ±</a></li>
                <li>3. <a href="#modules">ModÃ¼l DetaylarÄ±</a></li>
                <li>4. <a href="#dataflow">Veri AkÄ±ÅŸÄ±</a></li>
                <li>5. <a href="#testing">Test SenaryolarÄ±</a></li>
                <li>6. <a href="#metrics">Metrik Hesaplama</a></li>
                <li>7. <a href="#limitations">KÄ±sÄ±tlamalar</a></li>
            </ul>
        </nav>

        <section id="architecture" class="card">
            <h2>ğŸ—ï¸ Mimari Genel BakÄ±ÅŸ</h2>
            <div class="flow-diagram">
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ run_paper.py â”‚ â—„â”€â”€ Orchestrator (GÃ¼nlÃ¼k Ã§alÄ±ÅŸÄ±r)
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ daily_run.get_signal_snapshots() â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ Signal â”‚ Model sinyali, Rejim, Macro Gate durumu
                â”‚ Snapshot â”‚ Confidence, Pozisyon boyutu, Fiyat
                â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ PaperEngine.execute_snapshot() â”‚ â—„â”€â”€ Shadow Execution MantÄ±ÄŸÄ±
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ PaperLogger.log_decision() â”‚ â—„â”€â”€ JSON Lines formatÄ±nda kayÄ±t
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ logs/paper_ â”‚
                â”‚ trading/*.jsonâ”‚
                â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ analyze_paper.py â”‚ â—„â”€â”€ Performans Raporu
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            </div>
        </section>

        <section id="files" class="card">
            <h2>ğŸ—‚ï¸ Dosya YapÄ±sÄ±</h2>
            <table>
                <thead>
                    <tr>
                        <th>Dosya</th>
                        <th>Rol</th>
                        <th>BaÄŸÄ±mlÄ±lÄ±klar</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>run_paper.py</code></td>
                        <td>Orchestrator - GÃ¼nlÃ¼k Ã§alÄ±ÅŸtÄ±rÄ±lan ana script</td>
                        <td><code>daily_run</code>, <code>PaperEngine</code></td>
                    </tr>
                    <tr>
                        <td><code>core/paper_engine.py</code></td>
                        <td>Shadow Execution mantÄ±ÄŸÄ±</td>
                        <td><code>PaperLogger</code></td>
                    </tr>
                    <tr>
                        <td><code>core/paper_logger.py</code></td>
                        <td>JSON Lines formatÄ±nda loglama</td>
                        <td>-</td>
                    </tr>
                    <tr>
                        <td><code>analyze_paper.py</code></td>
                        <td>Log analizi ve raporlama</td>
                        <td><code>PaperLogger</code>, <code>DataLoader</code></td>
                    </tr>
                </tbody>
            </table>
        </section>

        <section id="modules" class="card">
            <h2>ğŸ”§ ModÃ¼l DetaylarÄ±</h2>

            <h3>1. PaperLogger</h3>
            <p><strong>Konum:</strong> <code>core/paper_logger.py</code></p>
            <pre><code><span class="highlight-purple">class</span> <span class="highlight-green">PaperLogger</span>:
    <span class="highlight-purple">def</span> <span class="highlight-blue">__init__</span>(self, log_dir=<span class="highlight-yellow">"logs/paper_trading"</span>)
    <span class="highlight-purple">def</span> <span class="highlight-blue">log_decision</span>(self, snapshot: dict) -> None
    <span class="highlight-purple">def</span> <span class="highlight-blue">load_logs</span>(self, start_date=None, end_date=None) -> pd.DataFrame</code></pre>

            <p><strong>Log FormatÄ±:</strong> JSON Lines</p>
            <pre><code>{"timestamp": "2024-02-01T10:00:00", "ticker": "ASELS.IS", "action": "BUY", ...}
{"timestamp": "2024-02-01T10:01:00", "ticker": "GARAN.IS", "action": "WAIT", ...}</code></pre>

            <h3>2. PaperEngine</h3>
            <p><strong>Konum:</strong> <code>core/paper_engine.py</code></p>
            <pre><code><span class="highlight-purple">class</span> <span class="highlight-green">PaperEngine</span>:
    <span class="highlight-purple">def</span> <span class="highlight-blue">__init__</span>(self)
    <span class="highlight-purple">def</span> <span class="highlight-blue">execute_snapshot</span>(self, snapshot: dict) -> dict</code></pre>

            <p><strong>Execution Logic:</strong></p>
            <table>
                <thead>
                    <tr>
                        <th>KoÅŸul</th>
                        <th>SonuÃ§</th>
                        <th>blocked_reason</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Signal == 'WAIT'</td>
                        <td><span class="badge badge-danger">BLOCKED</span></td>
                        <td><code>NO_SIGNAL</code></td>
                    </tr>
                    <tr>
                        <td>macro_blocked == True</td>
                        <td><span class="badge badge-danger">BLOCKED</span></td>
                        <td><code>MACRO_GATE_BLOCK</code></td>
                    </tr>
                    <tr>
                        <td>size â‰¤ 0</td>
                        <td><span class="badge badge-danger">BLOCKED</span></td>
                        <td><code>ZERO_QUANTITY</code></td>
                    </tr>
                    <tr>
                        <td>Otherwise</td>
                        <td><span class="badge badge-success">EXECUTED</span></td>
                        <td><code>null</code></td>
                    </tr>
                </tbody>
            </table>

            <h3>3. Signal Snapshot YapÄ±sÄ±</h3>
            <table>
                <thead>
                    <tr>
                        <th>Alan</th>
                        <th>Tip</th>
                        <th>AÃ§Ä±klama</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>ticker</code></td>
                        <td>string</td>
                        <td>Hisse kodu (Ã¶rn: ASELS.IS)</td>
                    </tr>
                    <tr>
                        <td><code>sector</code></td>
                        <td>string</td>
                        <td>BANKING, HOLDING, INDUSTRIAL, GROWTH</td>
                    </tr>
                    <tr>
                        <td><code>timestamp</code></td>
                        <td>string</td>
                        <td>ISO 8601 format</td>
                    </tr>
                    <tr>
                        <td><code>action</code></td>
                        <td>string</td>
                        <td>BUY / SELL / WAIT</td>
                    </tr>
                    <tr>
                        <td><code>confidence</code></td>
                        <td>float</td>
                        <td>0.0 - 1.0 arasÄ± gÃ¼ven skoru</td>
                    </tr>
                    <tr>
                        <td><code>regime</code></td>
                        <td>string</td>
                        <td>Trend_Up / Sideways / Crash_Bear</td>
                    </tr>
                    <tr>
                        <td><code>macro_blocked</code></td>
                        <td>boolean</td>
                        <td>Macro Gate blokaj durumu</td>
                    </tr>
                    <tr>
                        <td><code>current_price</code></td>
                        <td>float</td>
                        <td>GÃ¼ncel fiyat</td>
                    </tr>
                    <tr>
                        <td><code>size</code></td>
                        <td>float</td>
                        <td>Ã–nerilen pozisyon boyutu (%)</td>
                    </tr>
                </tbody>
            </table>

            <h3>4. analyze_paper.py CLI</h3>
            <pre><code><span class="highlight-yellow"># Temel rapor (hÄ±zlÄ±)</span>
python analyze_paper.py

<span class="highlight-yellow"># Forward Return dahil (yavaÅŸ)</span>
python analyze_paper.py --pnl</code></pre>
        </section>

        <section id="dataflow" class="card">
            <h2>ğŸ”„ Veri AkÄ±ÅŸÄ±</h2>
            <div class="flow-diagram">
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ run_paper.py â”‚
                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                â”‚ â”‚
                â”‚ 1ï¸âƒ£ get_signal_snapshots(verbose=True) â”‚
                â”‚ â””â”€â–º Model sinyalleri + Macro Gate durumu dÃ¶ner â”‚
                â”‚ â”‚
                â”‚ 2ï¸âƒ£ Her snapshot iÃ§in: â”‚
                â”‚ â””â”€â–º PaperEngine.execute_snapshot() â”‚
                â”‚ â””â”€â–º executed / blocked kararÄ± â”‚
                â”‚ â””â”€â–º PaperLogger.log_decision() â†’ JSON â”‚
                â”‚ â”‚
                â”‚ 3ï¸âƒ£ Oturum Ã¶zeti konsola basÄ±lÄ±r â”‚
                â”‚ â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            </div>
        </section>

        <section id="testing" class="card">
            <h2>ğŸ§ª Test SenaryolarÄ±</h2>

            <h3>Birim Testi (Normal Ä°ÅŸlem)</h3>
            <pre><code><span class="highlight-purple">from</span> core.paper_engine <span class="highlight-purple">import</span> PaperEngine

engine = PaperEngine()
result = engine.execute_snapshot({
    <span class="highlight-yellow">'ticker'</span>: <span class="highlight-yellow">'TEST'</span>,
    <span class="highlight-yellow">'action'</span>: <span class="highlight-yellow">'BUY'</span>,
    <span class="highlight-yellow">'confidence'</span>: 0.85,
    <span class="highlight-yellow">'macro_blocked'</span>: <span class="highlight-blue">False</span>,
    <span class="highlight-yellow">'size'</span>: 100
})

<span class="highlight-purple">assert</span> result[<span class="highlight-yellow">'executed'</span>] == <span class="highlight-blue">True</span></code></pre>

            <h3>Macro Gate Blokaj Testi</h3>
            <pre><code>result = engine.execute_snapshot({
    <span class="highlight-yellow">'ticker'</span>: <span class="highlight-yellow">'TEST'</span>,
    <span class="highlight-yellow">'action'</span>: <span class="highlight-yellow">'BUY'</span>,
    <span class="highlight-yellow">'macro_blocked'</span>: <span class="highlight-blue">True</span>,  <span class="highlight-green"># â—„â”€â”€ Blokaj</span>
    <span class="highlight-yellow">'size'</span>: 100
})

<span class="highlight-purple">assert</span> result[<span class="highlight-yellow">'executed'</span>] == <span class="highlight-blue">False</span>
<span class="highlight-purple">assert</span> result[<span class="highlight-yellow">'blocked_reason'</span>] == <span class="highlight-yellow">'MACRO_GATE_BLOCK'</span></code></pre>
        </section>

        <section id="metrics" class="card">
            <h2>ğŸ“ Metrik Hesaplama FormÃ¼lleri</h2>

            <div class="formula-box">
                <strong>Forward Return</strong>
                <div class="formula">Forward_Return = (Exit_Price - Entry_Price) / Entry_Price</div>
                <small>Entry: Trade gÃ¼nÃ¼ kapanÄ±ÅŸ | Exit: Trade + N gÃ¼n sonraki kapanÄ±ÅŸ (N=5)</small>
            </div>

            <div class="formula-box">
                <strong>Shadow Sharpe Ratio</strong>
                <div class="formula">Sharpe = (Î¼ / Ïƒ) Ã— âˆš252</div>
                <small>Î¼: Ortalama getiri | Ïƒ: Standart sapma | 252: YÄ±llÄ±k iÅŸlem gÃ¼nÃ¼</small>
            </div>

            <div class="formula-box">
                <strong>Maximum Drawdown</strong>
                <div class="formula">Max_DD = max(Peak - Cumulative_PnL)</div>
                <small>Peak: O ana kadarki en yÃ¼ksek kÃ¼mÃ¼latif deÄŸer</small>
            </div>

            <div class="formula-box">
                <strong>Win Rate</strong>
                <div class="formula">Win_Rate = Count(Return > 0) / Total_Trades Ã— 100</div>
            </div>
        </section>

        <section id="limitations" class="card">
            <h2>âš ï¸ KÄ±sÄ±tlamalar ve Notlar</h2>

            <div class="alert alert-warning">
                <span>âš ï¸</span>
                <div>
                    <strong>GerÃ§ek Emir Yok:</strong> PaperEngine hiÃ§bir koÅŸulda broker API'ye baÄŸlanmaz. TÃ¼m iÅŸlemler
                    simÃ¼lasyondur.
                </div>
            </div>

            <div class="alert alert-info">
                <span>ğŸ’¡</span>
                <div>
                    <strong>Forward Return Gecikmesi:</strong> <code>--pnl</code> flag yfinance'dan veri Ã§eker, internet
                    baÄŸlantÄ±sÄ±na baÄŸlÄ± olarak yavaÅŸ olabilir.
                </div>
            </div>

            <h3>Bilinen SÄ±nÄ±rlamalar</h3>
            <ul style="margin-left: 20px; margin-top: 10px;">
                <li>Model haftalÄ±k sinyal Ã¼retir, gÃ¼nlÃ¼k log'da aynÄ± sinyal tekrarlanabilir</li>
                <li>JSON Lines formatÄ± append-only, uzun vadede dosya boyutu artabilir</li>
                <li>Position tracking stateless (sanal portfÃ¶y state'i tutulmuyor)</li>
            </ul>

            <h3 style="margin-top: 25px;">GeliÅŸtirme Ã–nerileri</h3>
            <table>
                <thead>
                    <tr>
                        <th>Ã–neri</th>
                        <th>AÃ§Ä±klama</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Log Rotasyonu</td>
                        <td>AylÄ±k arÅŸivleme mekanizmasÄ±</td>
                    </tr>
                    <tr>
                        <td>Real-time Dashboard</td>
                        <td>Streamlit ile canlÄ± izleme paneli</td>
                    </tr>
                    <tr>
                        <td>Slippage SimÃ¼lasyonu</td>
                        <td>Hacim bazlÄ± slippage hesabÄ±</td>
                    </tr>
                    <tr>
                        <td>Position Tracking</td>
                        <td>Sanal portfÃ¶y state yÃ¶netimi</td>
                    </tr>
                </tbody>
            </table>
        </section>

    </div>

    <footer>
        <p>BIST30 AI Trader Â© 2026 | Paper Trading Technical Documentation v1.0</p>
        <p>Bu sistem canlÄ± para kullanmaz. TÃ¼m iÅŸlemler simÃ¼lasyondur.</p>
    </footer>

</body>

</html>