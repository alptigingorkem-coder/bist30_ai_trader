# Development Log - 2026-02-06

## ğŸ¯ GÃ¼nÃ¼n Hedefi
Model doÄŸruluÄŸunu ve risk yÃ¶netimini artÄ±rmak iÃ§in LightGBM modeline ek olarak Derin Ã–ÄŸrenme (TFT) katmanÄ± ve Kelly Criterion tabanlÄ± pozisyon yÃ¶netimi eklemek.

## ğŸ› ï¸ YapÄ±lan Teknik DeÄŸiÅŸiklikler

### 1. Veri AltyapÄ±sÄ± (Data Layer)
- **Macro Data Entegrasyonu (`utils/macro_data_loader.py`):**
  - `TurkeyMacroData` sÄ±nÄ±fÄ± oluÅŸturuldu.
  - TCMB (EVDS) Ã¼zerinden Faiz OranlarÄ± ve USDTRY verisi Ã§ekildi.
  - Veri eksiklikleri iÃ§in fallback mekanizmalarÄ± ve forward-fill stratejisi uygulandÄ±.

### 2. Feature Engineering (`utils/feature_engineering.py`)
- **TFT Feature'larÄ±:** Temporal Fusion Transformer mimarisi iÃ§in gerekli zamansal Ã¶zellikler eklendi:
  - `add_transformer_features()` metodu ile `DayOfWeek`, `Month`, `usdtry_shock`, `vix_high` gibi sinyaller Ã¼retildi.
  - Feature Engineering pipeline'Ä±na entegre edildi.
  - `clean_data` ve `process_all` metodlarÄ±na, model stabilitesini artÄ±rmak iÃ§in `Infinity` (sonsuzluk) deÄŸerlerini temizleyen korumalar eklendi.

### 3. Model Mimarisi
- **TFT Modeli (`models/transformer_model.py`):**
  - `pytorch_forecasting` kullanÄ±larak Temporal Fusion Transformer mimarisi implemente edildi.
  - `BIST30TransformerModel` sÄ±nÄ±fÄ± ile veri seti oluÅŸturma (`TimeSeriesDataSet`), model inÅŸasÄ± ve eÄŸitim dÃ¶ngÃ¼sÃ¼ kapsÃ¼llendi.
  - **Quantile Loss:** Model, tek bir deÄŸer yerine 7 farklÄ± olasÄ±lÄ±k seviyesi (quantile) tahmin edecek ÅŸekilde yapÄ±landÄ±rÄ±ldÄ±.

- **Ensemble YapÄ±sÄ± (`models/ensemble_model.py`):**
  - LightGBM (Gradient Boosting) ve TFT (Deep Learning) tahminlerini birleÅŸtiren "Rank Averaging" (SÄ±ralama OrtalamasÄ±) mantÄ±ÄŸÄ± kuruldu.
  - AÄŸÄ±rlÄ±klar: %60 LightGBM, %40 TFT.

### 4. Risk YÃ¶netimi
- **Kelly Criterion (`core/position_sizing.py`):**
  - GeÃ§miÅŸ iÅŸlem performansÄ±na gÃ¶re optimal pozisyon bÃ¼yÃ¼klÃ¼ÄŸÃ¼nÃ¼ hesaplayan `KellyPositionSizer` sÄ±nÄ±fÄ± yazÄ±ldÄ±.
  - **Backtest Entegrasyonu:** Backtest motoruna Kelly Position Sizer ve Macro Gate (piyasa riski kontrolÃ¼) baÄŸlandÄ±.

### 5. Validasyon ve Test
- `tests/verify_all.py` ile modÃ¼l entegrasyonu doÄŸrulandÄ±.
- `train_models.py` ile modeller (LightGBM ve TFT) baÅŸarÄ±yla eÄŸitildi ve kaydedildi.
- Test setinde (2024+) yapÄ±lan denemelerde bazÄ± hisselerdeki veri dÃ¼zensizlikleri tespit edildi ve giderildi.

### 6. Veri AltyapÄ±sÄ± GÃ¼Ã§lendirme (Critical Patch)
KullanÄ±cÄ±nÄ±n veri gÃ¼venliÄŸi talebi Ã¼zerine ek gÃ¼venlik Ã¶nlemleri alÄ±ndÄ±:
- **Universal Fallback (`utils/data_loader.py`):** Yahoo Finance verisinde kesinti olursa otomatik olarak **Ä°ÅŸ YatÄ±rÄ±m** (`isyatirimhisse`) kÃ¼tÃ¼phanesinden veri Ã§eken yedekleme sistemi tÃ¼m hisseler iÃ§in aktif hale getirildi.
- **Data Sanity Check:** Ä°ndirilen verilerin mantÄ±klÄ± olup olmadÄ±ÄŸÄ±nÄ± (Ã¶rn. %60 Ã¼zeri ani dÃ¼ÅŸÃ¼ÅŸler) kontrol eden ve hatalÄ± veriyi iÅŸleme almayan bir filtre eklendi.
- **Ã–zel EÅŸleÅŸmeler:** `KOZAL` gibi veri saÄŸlayÄ±cÄ±lar arasÄ±nda sembol farkÄ± (Mapping) olan hisseler iÃ§in Ã¶zel tanÄ±mlamalar yapÄ±ldÄ±.

## ğŸ“ SonuÃ§
Sistem, sadece model baÅŸarÄ±sÄ± aÃ§Ä±sÄ±ndan deÄŸil, veri gÃ¼venliÄŸi ve operasyonel sÃ¼reklilik aÃ§Ä±sÄ±ndan da "Production-Ready" (CanlÄ± KullanÄ±ma HazÄ±r) hale getirildi. YarÄ±n sabah `daily_run.py` ile gÃ¼venle Ã§alÄ±ÅŸtÄ±rÄ±labilir.
