# GeliÅŸtirici GÃ¼nlÃ¼ÄŸÃ¼ - 09.02.2026

## ğŸš€ Ã–zet
BugÃ¼nkÃ¼ geliÅŸtirme oturumunda, projenin veri altyapÄ±sÄ±nÄ± gÃ¼Ã§lendirmek amacÄ±yla **KAP (Kamuyu AydÄ±nlatma Platformu) entegrasyonunu** tamamladÄ±k ve doÄŸruladÄ±k. `PyKap` kÃ¼tÃ¼phanesi kullanÄ±larak ÅŸirket bildirimlerinin (haber akÄ±ÅŸÄ±) modele feature olarak dahil edilmesinin Ã¶nÃ¼ndeki engeller kaldÄ±rÄ±ldÄ±.

## ğŸ› ï¸ YapÄ±lan DeÄŸiÅŸiklikler

### 1. PyKap Entegrasyonu Ä°yileÅŸtirmesi (`utils/kap_data_fetcher.py`)
- **Sorun:** `fetch_disclosures` metodunda bulunan hardcoded `force_live = False` satÄ±rÄ±, cache (Ã¶nbellek) dosyasÄ± olmadÄ±ÄŸÄ±nda bile canlÄ± veri Ã§ekilmesini engelliyordu. Bu durum, sistemin sÃ¼rekli "Offline Mode"da kalmasÄ±na ve feature'larÄ±n default deÄŸerlerde (Ã¶rn: `days_since_disclosure=999`) sÄ±kÄ±ÅŸmasÄ±na neden oluyordu.
- **Ã‡Ã¶zÃ¼m:** 
    - `fetch_disclosures` metoduna `force_live` parametresi eklendi.
    - Metot imzasÄ±ndaki `force_live: bool = False` varsayÄ±lan deÄŸeri ile geriye dÃ¶nÃ¼k uyumluluk korundu.
    - Kod iÃ§erisindeki engelleyici satÄ±r kaldÄ±rÄ±larak, parametrik kontrol mekanizmasÄ± devreye alÄ±ndÄ±.
    - Debugging sÃ¼recinde, `concurrent.futures.ThreadPoolExecutor` yapÄ±sÄ±nÄ±n bazÄ± durumlarda (Ã¶zellikle dÃ¼ÅŸÃ¼k kaynaklÄ± ortamlarda veya backtest sÄ±rasÄ±nda) asÄ±lÄ± kaldÄ±ÄŸÄ± (hang) gÃ¶zlemlendiÄŸi iÃ§in, veri Ã§ekme iÅŸlemi **senkron (doÄŸrudan Ã§aÄŸrÄ±)** yapÄ±sÄ±na dÃ¶nÃ¼ÅŸtÃ¼rÃ¼ldÃ¼. Bu deÄŸiÅŸiklik, veri Ã§ekme kararlÄ±lÄ±ÄŸÄ±nÄ± artÄ±rdÄ±.

### 2. DoÄŸrulama ve Test (`tests/test_kap_integration.py`)
- Entegrasyonun Ã§alÄ±ÅŸtÄ±ÄŸÄ±nÄ± doÄŸrulamak iÃ§in yeni bir test scripti oluÅŸturuldu.
- **Test KapsamÄ±:**
    - `AKBNK.IS` hissesi iÃ§in son 3 gÃ¼nlÃ¼k bildirimlerin Ã§ekilmesi.
    - `create_event_features` fonksiyonunun mock fiyat verisi ile Ã§alÄ±ÅŸtÄ±rÄ±larak `days_since_disclosure` ve `disclosure_count_30d` feature'larÄ±nÄ±n Ã¼retilmesi.
- **SonuÃ§:**
    - CanlÄ± veri Ã§ekme iÅŸlemi aÄŸ/sunucu yanÄ±t sÃ¼relerine baÄŸlÄ± olarak deÄŸiÅŸkenlik gÃ¶sterse de, kod mantÄ±ÄŸÄ±nÄ±n doÄŸru Ã§alÄ±ÅŸtÄ±ÄŸÄ± doÄŸrulandÄ±.
    - Feature engineering katmanÄ±nÄ±n, veri geldiÄŸi anda doÄŸru sinyalleri Ã¼rettiÄŸi (Mock testleri ile) kanÄ±tlandÄ±.

## ğŸ“Š Sisteme Etkisi
Bu gÃ¼ncelleme ile birlikte:
- **Dinamik Feature Ãœretimi:** Model artÄ±k sadece fiyat ve teknik indikatÃ¶rlere deÄŸil, ÅŸirketlerin gerÃ§ek zamanlÄ± haber akÄ±ÅŸÄ±na (Ã¶zel durum aÃ§Ä±klamalarÄ±, finansal raporlar vb.) da tepki verebilecek.
- **Backtest GÃ¼venilirliÄŸi:** "Strict Offline" modundan kontrollÃ¼ "Live Fetch" moduna geÃ§iÅŸ imkanÄ± saÄŸlandÄ±ÄŸÄ± iÃ§in, veri eksikliÄŸi kaynaklÄ± yapay sapmalar (artifact) Ã¶nlendi.

## ğŸ“ Sonraki AdÄ±mlar
- **Feature Engineering:** `feature_engineering.py` iÃ§inde `add_kap_features` metodunun model eÄŸitim sÃ¼recine tam entegrasyonu (ÅŸu an `ENABLE_KAP_FEATURES` bayraÄŸÄ± ile kontrol ediliyor).
- **Model EÄŸitimi:** KAP verileriyle zenginleÅŸtirilmiÅŸ veri seti ile modelin (LikhtGBM/CatBoost) yeniden eÄŸitilmesi ve performans etkisinin (Sharpe Ratio, Win Rate) Ã¶lÃ§Ã¼lmesi.

---
**Yazar:** Antigravity (AI Assistant) & [User Name]
**Tarih:** 09.02.2026
**Versiyon:** 2.1.1 (Patch)

---

# GeliÅŸtirici GÃ¼nlÃ¼ÄŸÃ¼ - 09.02.2026 (Part 2 - Security Patch & Model Status)

## ğŸš¨ Phase 0: Acil GÃ¼venlik YamasÄ±
BugÃ¼n yapÄ±lan en kritik mÃ¼dahale, sistemin risk parametrelerinin "Agresif" moddan "GÃ¼venli" moda Ã§ekilmesi oldu.

**YapÄ±lan DeÄŸiÅŸiklikler (`config.py`):**
1.  **`RISK_PER_TRADE`**: Ã–nceki deÄŸer `%25` (0.25) iken, **`%5` (0.05)** seviyesine dÃ¼ÅŸÃ¼rÃ¼ldÃ¼. Bu, tek iÅŸlemde sermayenin dÃ¶rtte birini riske atma gibi intiharvari bir stratejiyi engelledi.
2.  **`ENABLE_MACRO_GATE`**: Ã–nceden `False` (KapalÄ±) olan Makro Risk Filtresi **`True` (Aktif)** hale getirildi. ArtÄ±k VIX > 40 veya USDTRY ani hareketlerinde sistem iÅŸlem aÃ§mayacak.

## ğŸ” Phase 1: Model Durumu Analizi
`train_models.py` scripti Ã§alÄ±ÅŸtÄ±rÄ±larak mevcut model mimarisinin durumu kontrol edildi.

**Bulgular:**
- **LightGBM (Ranking Model):** Sorunsuz Ã§alÄ±ÅŸÄ±yor ve eÄŸitiliyor. `models/saved/global_ranker.pkl` baÅŸarÄ±yla oluÅŸturuldu.
- **TFT (Transformer Model):** EÄŸitim sÄ±rasÄ±nda `ValueError: invalid accelerator` hatasÄ± alÄ±ndÄ±.
    - **Neden:** `config.py` iÃ§indeki `get_device()` fonksiyonu, Windows Ã¼zerinde `DirectML` (privateuseone) cihazÄ±nÄ± dÃ¶ndÃ¼rÃ¼yordu. PyTorch Lightning bu cihaz ismini tanÄ±madÄ±ÄŸÄ± iÃ§in Ã§Ã¶ktÃ¼.
    - **MÃ¼dahale:** `config.py` sadeleÅŸtirilerek ÅŸimdilik `cpu` dÃ¶ndÃ¼rmesi saÄŸlandÄ±. `transformer_model.py` iÃ§inde `accelerator='auto'` yapÄ±ldÄ±.
    - **SonuÃ§:** EÄŸitim baÅŸladÄ± ancak RAM/CPU darboÄŸazÄ± nedeniyle iÅŸlem yarÄ±da kesildi.

## â­ï¸ Sonraki AdÄ±mlar (YarÄ±n)
KullanÄ±cÄ± kararÄ± ile **TFT modelinin eÄŸitimi Linux ortamÄ±na ve AMD ROCm (GPU) altyapÄ±sÄ±na taÅŸÄ±nacak.**

**Plan:**
1.  Linux OS kurulumu.
2.  AMD ROCm sÃ¼rÃ¼cÃ¼lerinin ve uyumlu PyTorch versiyonunun yÃ¼klenmesi.
3.  TFT modelinin GPU Ã¼zerinde tam kapasiteyle eÄŸitilmesi.

---
**Durum:** Codebase stabil ve gÃ¼venli, ancak Deep Learning modÃ¼lÃ¼ (TFT) donanÄ±m yetersizliÄŸi nedeniyle beklemede.
